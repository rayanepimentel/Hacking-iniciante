üëæ [Inicio](https://rayanepimentel.github.io/InfoSec-iniciante/) | [Cronograma](https://rayanepimentel.github.io/InfoSec-iniciante/cronograma/) | [Cursos](https://rayanepimentel.github.io/InfoSec-iniciante/cursos/) | [Desenvolvimento Seguro](https://rayanepimentel.github.io/InfoSec-iniciante/cursos/desenvolvimento-seguro/) | [Desenvolvimento Seguro - Parte I](inicio.md)


# SQL Injection

## Introdu√ß√£o

`SQL Injection`: [Introdu√ß√£o - SQL Injection](../../Security-for-developers/09-sql.md)


## ORM

- [O que √© ORM - TreinaWeb](https://www.treinaweb.com.br/blog/o-que-e-orm)
- [ORM - C√≥digo Fonte TV](https://www.youtube.com/watch?v=snOXxJa31GI&ab_channel=C%C3%B3digoFonteTV)


J√° sabemos o que √© ORM, vou usar com exemplo o framework `Sequelize`.

```js
const Sequelize = require('sequelize');
const sequelize = new Sequelize('database', 'username', 'password', { /* connection details */ });

const User = sequelize.define('user', {
  username: Sequelize.STRING,
  password: Sequelize.STRING
});
User.findOne({ where: { username: userInput } })
  .then(user => {
    // L√≥gica ap√≥s encontrar o usu√°rio
  })
  .catch(error => {
    // L√≥gica para lidar com erros
  });
```

Nesse exemplo o `userInput` estaria vulner√°vel? O que aconteceria se o usu√°rio digitasse: `' OR '1'='1` ?  
<br>

R: Sim √© vulner√°vel. O `userInput` cont√©m `' OR '1'='1`, uma condi√ß√£o booleana que sempre ser√° verdadeira em SQL. O resultado seria o retorno de todos os usu√°rios.
<br>
Isso √© uma forma cl√°ssica de inje√ß√£o de SQL, onde a entrada do usu√°rio √© usada para alterar a l√≥gica da consulta SQL.

### Como mitigar


Para evitar esse tipo de vulnerabilidade, voc√™ deve sempre tratar as entradas do usu√°rio como dados brutos e nunca inclu√≠-las diretamente em consultas SQL. Como estamos utilizando o ORM Sequelize, existe um operador que garante o tratamento dessa vulnerabilidade.

```js
User.findOne({ where: { username: { [Sequelize.Op.like]: `%${userInput}%` } } })
 .then(user => {
    // L√≥gica ap√≥s encontrar o usu√°rio
  })
 .catch(error => {
    // L√≥gica para lidar com erros
  });
```

Ao usar o operador `Sequelize.Op.like`, garante que o `userInput` seja tratado como um dado simples e n√£o como parte da consulta SQL.


<br>
<hr>
<br>

[< Anterior](inicio.md) | [Pr√≥xima >](03-InsecureRandomness.md)